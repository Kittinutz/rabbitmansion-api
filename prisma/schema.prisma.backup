// ================================================================
// HOTEL MANAGEMENT SYSTEM - PRISMA SCHEMA
// ================================================================
// Comprehensive database design for admin dashboard
// Features: Multi-language support, Audit logging, Analytics
// Architecture: Modular design with clear domain separation
// ================================================================

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ================================================================
// CORE ENUMS - Business Logic Constants
// ================================================================

// Room Management Enums
enum RoomType {
  STANDARD      // Standard rooms with basic amenities
  DELUXE        // Enhanced rooms with additional features
  SUITE         // Multi-room suites with living areas
  PRESIDENTIAL  // Luxury suites with premium amenities
  FAMILY        // Family-oriented rooms with extra space
  ACCESSIBLE    // ADA compliant rooms for disabled guests
}

enum RoomStatus {
  AVAILABLE     // Ready for booking and check-in
  OCCUPIED      // Currently has guests
  MAINTENANCE   // Under scheduled maintenance
  OUT_OF_ORDER  // Temporarily unavailable due to issues
  CLEANING      // Being cleaned between guests
}

// Booking & Reservation Enums
enum BookingStatus {
  PENDING       // Awaiting confirmation or payment
  CONFIRMED     // Confirmed and ready for check-in
  CHECKED_IN    // Guest has checked in
  CHECKED_OUT   // Guest has checked out
  CANCELLED     // Booking was cancelled
  NO_SHOW       // Guest didn't show up
}

// Payment & Financial Enums
enum PaymentMethod {
  CREDIT_CARD   // Credit card payments
  DEBIT_CARD    // Debit card payments
  CASH          // Cash payments
  BANK_TRANSFER // Direct bank transfers
  MOBILE_PAYMENT // Mobile payment apps
}

enum PaymentStatus {
  PENDING       // Payment not yet processed
  PAID          // Fully paid
  PARTIALLY_PAID // Partial payment received
  REFUNDED      // Payment was refunded
  FAILED        // Payment processing failed
}

enum RefundStatus {
  PENDING       // Refund request submitted
  APPROVED      // Refund approved by admin
  REJECTED      // Refund request rejected
  PROCESSED     // Refund completed and processed
}

// Service & Guest Management Enums
enum ServiceCategory {
  ROOM_SERVICE    // In-room dining and amenities
  SPA             // Spa and wellness services
  TRANSPORTATION  // Airport transfers, car rentals
  DINING          // Restaurant reservations
  LAUNDRY         // Laundry and dry cleaning
  ENTERTAINMENT   // Shows, tours, activities
  BUSINESS        // Meeting rooms, business center
}

enum ServiceStatus {
  ACTIVE        // Service currently available
  INACTIVE      // Service temporarily unavailable
  SEASONAL      // Service available during specific seasons
}

enum GuestStatus {
  ACTIVE        // Regular active guest
  BLOCKED       // Blocked from making bookings
  VIP           // VIP status with special privileges
}

// System & Audit Enums
enum AuditAction {
  CREATE        // Record creation
  UPDATE        // Record modification
  DELETE        // Record deletion
  LOGIN         // User login
  LOGOUT        // User logout
}

// ================================================================
// USER MANAGEMENT MODELS - Authentication & Authorization
// ================================================================

// Admin Users - System administrators and staff
model Admin {
  id          String   @id @default(uuid())
  email       String   @unique
  username    String   @unique
  password    String   // Hashed password (use bcrypt)
  firstName   String
  lastName    String
  role        String   @default("ADMIN") // ADMIN, MANAGER, RECEPTIONIST
  isActive    Boolean  @default(true)
  lastLogin   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations - Track admin activities
  auditLogs       AuditLog[]
  createdBookings Booking[] @relation("AdminCreatedBookings")
  updatedBookings Booking[] @relation("AdminUpdatedBookings")

  @@map("admins")
}

// Hotel Guests - Customer information and preferences
model Guest {
  id          String      @id @default(uuid())
  email       String      @unique
  phone       String?
  firstName   String
  lastName    String
  dateOfBirth DateTime?
  nationality String?
  passport    String?     // Passport number for international guests
  
  // Address Information
  address     String?
  city        String?
  country     String?
  postalCode  String?
  
  // Guest Profile & Preferences
  preferences String[]    // ["late_checkout", "room_service", "spa"]
  status      GuestStatus @default(ACTIVE)
  vipLevel    Int         @default(0) // 0=Regular, 1=Silver, 2=Gold, 3=Platinum
  totalStays  Int         @default(0)
  totalSpent  Float       @default(0)
  notes       String?     // Staff notes about guest preferences
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations - Guest activities and interactions
  bookings       Booking[]
  reviews        Review[]
  loyaltyProgram LoyaltyProgram?

  @@map("guests")
}

// ================================================================
// ROOM MANAGEMENT MODELS - Inventory & Maintenance
// ================================================================

// Hotel Rooms - Core inventory with multi-language support
model Room {
  id              String     @id @default(uuid())
  roomNumber      String     @unique // "101", "A-205", etc.
  roomType        RoomType
  status          RoomStatus @default(AVAILABLE)
  floor           Int
  maxOccupancy    Int        @default(2)
  bedCount        Int        @default(1)
  bedType         String?    // "King", "Queen", "Twin", "Sofa Bed"
  basePrice       Float      // Base nightly rate
  seasonalPricing Json?      // {"peak": 1.5, "low": 0.8} multipliers
  
  // Room Features
  size            Float?     // Room size in square meters
  view            String?    // "Ocean", "City", "Garden", "Pool"
  smokingAllowed  Boolean    @default(false)
  petFriendly     Boolean    @default(false)
  accessible      Boolean    @default(false) // ADA compliance
  
  // Multi-language Content Support
  name            Json       // {"en": "Deluxe Room", "th": "ห้องดีลักซ์"}
  description     Json       // Multi-language room descriptions
  amenities       String[]   // ["wifi", "minibar", "balcony", "jacuzzi"]
  
  // Media & Visual Content
  mainImage       String?    // Primary room photo URL
  galleryImages   String[]   // Additional room photos
  bannerImage     String?    // Featured banner image
  
  // Maintenance & Operations
  lastCleaned     DateTime?
  lastMaintenance DateTime?
  notes           String?    // Staff notes about room conditions
  isActive        Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relations - Room activities and content
  bookings        Booking[]
  roomImages      RoomImage[]
  maintenanceLogs MaintenanceLog[]

  @@index([status])
  @@index([roomType])
  @@index([floor])
  @@index([isActive])
  @@map("rooms")
}

// Room Images - Media management for rooms
model RoomImage {
  id        String   @id @default(uuid())
  roomId    String
  url       String   // Image URL or file path
  alt       String?  // Alt text for accessibility
  caption   Json?    // {"en": "Ocean view", "th": "วิวทะเล"}
  isPrimary Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())

  // Relations
  room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@map("room_images")
}

// ================================================================
// BOOKING & RESERVATION MODELS - Customer Journey Management
// ================================================================

// Hotel Bookings - Core reservation system
model Booking {
  id              String        @id @default(uuid())
  bookingNumber   String        @unique // "BK-2024-001234"
  guestId         String
  roomId          String
  
  // Stay Dates & Timeline
  checkInDate     DateTime
  checkOutDate    DateTime
  actualCheckIn   DateTime?     // Actual check-in time
  actualCheckOut  DateTime?     // Actual check-out time
  
  // Guest Information
  numberOfGuests  Int           @default(1)
  numberOfChildren Int          @default(0)
  specialRequests String?       // Dietary restrictions, accessibility needs
  
  // Financial Information
  roomRate        Float         // Rate at time of booking (preserves historical pricing)
  totalAmount     Float         // Total booking amount
  taxAmount       Float         @default(0)
  serviceCharges  Float         @default(0)
  discountAmount  Float         @default(0)
  finalAmount     Float         // Amount after discounts/taxes
  
  // Status
  status          BookingStatus @default(PENDING)
  
  // Metadata
  source          String?       // Website, Phone, Walk-in, etc.
  notes           String?
  cancellationReason String?
  createdById     String?       // Admin who created booking
  updatedById     String?       // Admin who last updated
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  guest           Guest         @relation(fields: [guestId], references: [id])
  room            Room          @relation(fields: [roomId], references: [id])
  createdBy       Admin?        @relation("AdminCreatedBookings", fields: [createdById], references: [id])
  updatedBy       Admin?        @relation("AdminUpdatedBookings", fields: [updatedById], references: [id])
  payments        Payment[]
  services        BookingService[]
  reviews         Review[]

  @@index([checkInDate])
  @@index([checkOutDate])
  @@index([status])
  @@index([guestId])
  @@index([roomId])
  @@map("bookings")
}

// ================================================================
// FINANCIAL MODELS - Payments, Refunds & Revenue Tracking
// ================================================================

// Payment Processing - Transaction management
model Payment {
  id              String        @id @default(uuid())
  bookingId       String
  amount          Float
  currency        String        @default("THB") // Thai Baht
  paymentMethod   PaymentMethod
  status          PaymentStatus @default(PENDING)
  
  // Transaction Details
  transactionId   String?       // External payment gateway transaction ID
  gatewayResponse Json?         // Raw response from payment gateway
  
  // Audit & Metadata
  paidAt          DateTime?     // When payment was completed
  description     String?       // Payment description or memo
  notes           String?       // Internal staff notes
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  booking         Booking       @relation(fields: [bookingId], references: [id])
  refunds         Refund[]

  @@index([bookingId])
  @@index([paymentMethod])
  @@map("payments")
}

// Refund Management - Handle payment reversals
model Refund {
  id          String       @id @default(uuid())
  paymentId   String
  amount      Float        // Refund amount (can be partial)
  reason      String       // Reason for refund
  status      RefundStatus @default(PENDING)
  processedAt DateTime?    // When refund was processed
  notes       String?      // Additional notes about refund
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  payment     Payment      @relation(fields: [paymentId], references: [id])

  @@index([paymentId])
  @@index([status])
  @@map("refunds")
}

// ================================================================
// SERVICE MANAGEMENT MODELS - Hotel Services & Add-ons
// ================================================================

// Hotel Services - Additional services offered to guests
model Service {
  id          String          @id @default(uuid())
  code        String          @unique
  name        Json            // Multi-language names
  description Json?           // Multi-language descriptions
  category    ServiceCategory
  price       Float
  unit        String?         // per hour, per item, etc.
  status      ServiceStatus   @default(ACTIVE)
  isActive    Boolean         @default(true)
  
  // Availability
  availableDays String[]      // Days of week: MON, TUE, etc.
  availableFrom String?       // Time format: HH:mm
  availableTo   String?       // Time format: HH:mm
  
  // Metadata
  maxQuantity Int?           // Maximum quantity per booking
  requiresApproval Boolean   @default(false)
  notes       String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  // Relations
  bookingServices BookingService[]

  @@map("services")
}

model BookingService {
  id        String   @id @default(uuid())
  bookingId String
  serviceId String
  quantity  Int      @default(1)
  unitPrice Float    // Price at time of booking
  totalPrice Float   // quantity * unitPrice
  notes     String?
  createdAt DateTime @default(now())

  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  service   Service  @relation(fields: [serviceId], references: [id])

  @@map("booking_services")
}

// ================================================================
// CUSTOMER EXPERIENCE MODELS - Reviews & Loyalty Programs  
// ================================================================

// Guest Reviews - Feedback and ratings system
model Review {
  id          String   @id @default(uuid())
  bookingId   String
  guestId     String
  rating      Int      // 1-5 star rating
  title       String?  // Review title
  comment     String?  // Guest review text
  response    String?  // Hotel management response
  isVerified  Boolean  @default(false) // Verified stay
  isPublic    Boolean  @default(true)  // Display publicly
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  booking     Booking  @relation(fields: [bookingId], references: [id])
  guest       Guest    @relation(fields: [guestId], references: [id])

  @@index([guestId])
  @@index([rating])
  @@index([isPublic])
  @@map("reviews")
}

// Loyalty Program - Guest rewards and tier management
model LoyaltyProgram {
  id          String   @id @default(uuid())
  guestId     String   @unique
  points      Int      @default(0)
  tier        String   @default("BRONZE") // BRONZE, SILVER, GOLD, PLATINUM
  joinDate    DateTime @default(now())
  lastUpdated DateTime @updatedAt

  // Relations
  guest       Guest    @relation(fields: [guestId], references: [id])

  @@map("loyalty_programs")
}

// ================================================================
// MAINTENANCE & OPERATIONS MODELS - Facility Management
// ================================================================

// Room Maintenance Tracking - Service and repair logs
model MaintenanceLog {
  id          String   @id @default(uuid())
  roomId      String
  type        String   // "Cleaning", "Repair", "Inspection", "Renovation"
  description String   // Detailed description of work performed
  cost        Float?   // Cost of maintenance/repair
  performedBy String   // Staff member or contractor name
  startTime   DateTime // When maintenance started
  endTime     DateTime? // When maintenance completed
  isCompleted Boolean  @default(false)
  notes       String?  // Additional notes or observations
  createdAt   DateTime @default(now())

  // Relations
  room        Room     @relation(fields: [roomId], references: [id])

  @@index([roomId])
  @@index([isCompleted])
  @@index([type])
  @@map("maintenance_logs")
}

// ================================================================
// SECURITY & AUDIT MODELS - System Monitoring & Compliance
// ================================================================

// Audit Trail - Track all system changes for compliance
model AuditLog {
  id        String      @id @default(uuid())
  adminId   String
  action    AuditAction // CREATE, UPDATE, DELETE, LOGIN, LOGOUT
  entity    String      // Table/Model name (e.g., "Booking", "Guest")
  entityId  String      // Record ID that was affected
  oldValues Json?       // Previous values before change
  newValues Json?       // New values after change
  ipAddress String?     // IP address of the admin
  userAgent String?     // Browser/client information
  createdAt DateTime    @default(now())

  // Relations
  admin     Admin       @relation(fields: [adminId], references: [id])

  @@index([adminId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@index([action])
  @@map("audit_logs")
}

// ================================================================
// ANALYTICS & REPORTING MODELS - Business Intelligence
// ================================================================

// Daily Revenue Analytics - Key performance metrics
model DailyRevenue {
  id             String   @id @default(uuid())
  date           DateTime @unique @db.Date // Date for the revenue data
  roomRevenue    Float    @default(0)      // Revenue from room bookings
  serviceRevenue Float    @default(0)      // Revenue from additional services
  totalRevenue   Float    @default(0)      // Total combined revenue
  occupancyRate  Float    @default(0)      // Percentage of rooms occupied
  adr            Float    @default(0)      // Average Daily Rate
  revpar         Float    @default(0)      // Revenue Per Available Room
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([date])
  @@map("daily_revenue")
}

// ================================================================
// SYSTEM CONFIGURATION MODELS - Application Settings
// ================================================================

// System Settings - Configurable application parameters
model Settings {
  id        String   @id @default(uuid())
  key       String   @unique // Setting identifier (e.g., "hotel_name", "tax_rate")
  value     Json     // Setting value (can be string, number, object, array)
  category  String?  // Setting category for organization ("general", "payment", "email")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@map("settings")
}