// Base schema configuration for multi-file Prisma setup
// This file contains the generator and datasource configuration

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Booking and Reservation Models
// Complete booking lifecycle management

// Hotel Bookings - Core reservation system
model Booking {
  id            String @id @default(cuid())
  bookingNumber String @unique // "BK-2024-001234"
  guestId       String
  roomId        String

  // Stay Dates & Timeline
  checkInDate    DateTime
  checkOutDate   DateTime
  actualCheckIn  DateTime? // Actual check-in time
  actualCheckOut DateTime? // Actual check-out time

  // Guest Information
  numberOfGuests   Int     @default(1)
  numberOfChildren Int     @default(0)
  specialRequests  String? // Dietary restrictions, accessibility needs

  // Financial Information
  roomRate       Float // Rate at time of booking (preserves historical pricing)
  totalAmount    Float // Total booking amount
  taxAmount      Float @default(0)
  serviceCharges Float @default(0)
  discountAmount Float @default(0)
  finalAmount    Float // Amount after discounts/taxes

  // Status
  status BookingStatus @default(PENDING)

  // Metadata
  source             String? // Website, Phone, Walk-in, etc.
  notes              String?
  cancellationReason String?
  createdById        String? // Admin who created booking
  updatedById        String? // Admin who last updated
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  guest     Guest            @relation(fields: [guestId], references: [id])
  room      Room             @relation(fields: [roomId], references: [id])
  createdBy Admin?           @relation("AdminCreatedBookings", fields: [createdById], references: [id])
  updatedBy Admin?           @relation("AdminUpdatedBookings", fields: [updatedById], references: [id])
  payments  Payment[]
  services  BookingService[]
  reviews   Review[]

  @@index([checkInDate])
  @@index([checkOutDate])
  @@index([status])
  @@index([guestId])
  @@index([roomId])
  @@map("bookings")
}

// Customer Experience Models
// Reviews, loyalty programs, and guest feedback

// Guest Reviews - Feedback and ratings system
model Review {
  id         String   @id @default(cuid())
  bookingId  String
  guestId    String
  rating     Int // 1-5 star rating
  title      String? // Review title
  comment    String? // Guest review text
  response   String? // Hotel management response
  isVerified Boolean  @default(false) // Verified stay
  isPublic   Boolean  @default(true) // Display publicly
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])
  guest   Guest   @relation(fields: [guestId], references: [id])

  @@index([guestId])
  @@index([rating])
  @@index([isPublic])
  @@map("reviews")
}

// Loyalty Program - Guest rewards and tier management
model LoyaltyProgram {
  id          String   @id @default(cuid())
  guestId     String   @unique
  points      Int      @default(0)
  tier        String   @default("BRONZE") // BRONZE, SILVER, GOLD, PLATINUM
  joinDate    DateTime @default(now())
  lastUpdated DateTime @updatedAt

  // Relations
  guest Guest @relation(fields: [guestId], references: [id])

  @@map("loyalty_programs")
}

// Enumeration Definitions
// All enums used across the hotel management system

enum RoomType {
  STANDARD
  DELUXE
  SUITE
  PRESIDENTIAL
  FAMILY
  ACCESSIBLE
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  OUT_OF_ORDER
  CLEANING
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  NO_SHOW
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIALLY_PAID
  REFUNDED
  FAILED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  CASH
  BANK_TRANSFER
  MOBILE_PAYMENT
}

enum ServiceCategory {
  ROOM_SERVICE
  SPA
  TRANSPORTATION
  DINING
  LAUNDRY
  ENTERTAINMENT
  BUSINESS
}

enum ServiceStatus {
  ACTIVE
  INACTIVE
  SEASONAL
}

enum GuestStatus {
  ACTIVE
  BLOCKED
  VIP
}

enum RefundStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
}

// Financial Management Models  
// Payments, refunds, and revenue tracking

// Payment Processing - Transaction management
model Payment {
  id            String        @id @default(cuid())
  bookingId     String
  amount        Float
  currency      String        @default("THB") // Thai Baht
  paymentMethod PaymentMethod
  status        PaymentStatus @default(PENDING)

  // Transaction Details
  transactionId   String? // External payment gateway transaction ID
  gatewayResponse Json? // Raw response from payment gateway

  // Audit & Metadata
  paidAt      DateTime? // When payment was completed
  description String? // Payment description or memo
  notes       String? // Internal staff notes
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  booking Booking  @relation(fields: [bookingId], references: [id])
  refunds Refund[]

  @@index([bookingId])
  @@index([paymentMethod])
  @@map("payments")
}

// Refund Management - Handle payment reversals
model Refund {
  id          String       @id @default(cuid())
  paymentId   String
  amount      Float // Refund amount (can be partial)
  reason      String // Reason for refund
  status      RefundStatus @default(PENDING)
  processedAt DateTime? // When refund was processed
  notes       String? // Additional notes about refund
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  payment Payment @relation(fields: [paymentId], references: [id])

  @@index([paymentId])
  @@index([status])
  @@map("refunds")
}

// Daily Revenue Analytics - Key performance metrics
model DailyRevenue {
  id             String   @id @default(cuid())
  date           DateTime @unique @db.Date // Date for the revenue data
  roomRevenue    Float    @default(0) // Revenue from room bookings
  serviceRevenue Float    @default(0) // Revenue from additional services
  totalRevenue   Float    @default(0) // Total combined revenue
  occupancyRate  Float    @default(0) // Percentage of rooms occupied
  adr            Float    @default(0) // Average Daily Rate
  revpar         Float    @default(0) // Revenue Per Available Room
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([date])
  @@map("daily_revenue")
}

// Room Management Models
// Hotel rooms, images, and maintenance tracking

// Hotel Rooms - Core inventory with multi-language support
model Room {
  id              String     @id @default(cuid())
  roomNumber      String     @unique // "101", "A-205", etc.
  roomType        RoomType
  status          RoomStatus @default(AVAILABLE)
  floor           Int
  maxOccupancy    Int        @default(2)
  bedCount        Int        @default(1)
  bedType         String? // "King", "Queen", "Twin", "Sofa Bed"
  basePrice       Float // Base nightly rate
  seasonalPricing Json? // {"peak": 1.5, "low": 0.8} multipliers

  // Room Features
  size           Float? // Room size in square meters
  view           String? // "Ocean", "City", "Garden", "Pool"
  smokingAllowed Boolean @default(false)
  petFriendly    Boolean @default(false)
  accessible     Boolean @default(false) // ADA compliance

  // Multi-language Content Support
  name        Json // {"en": "Deluxe Room", "th": "ห้องดีลักซ์"}
  description Json // Multi-language room descriptions
  amenities   String[] // ["wifi", "minibar", "balcony", "jacuzzi"]

  // Media & Visual Content
  mainImage     String? // Primary room photo URL
  galleryImages String[] // Additional room photos
  bannerImage   String? // Featured banner image

  // Maintenance & Operations
  lastCleaned     DateTime?
  lastMaintenance DateTime?
  notes           String? // Staff notes about room conditions
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations - Room activities and content
  bookings        Booking[]
  roomImages      RoomImage[]
  maintenanceLogs MaintenanceLog[]

  @@index([status])
  @@index([roomType])
  @@index([floor])
  @@index([isActive])
  @@map("rooms")
}

// Room Images - Media management for rooms
model RoomImage {
  id        String   @id @default(cuid())
  roomId    String
  url       String // Image URL or file path
  alt       String? // Alt text for accessibility
  caption   Json? // {"en": "Ocean view", "th": "วิวทะเล"}
  isPrimary Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())

  // Relations
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@map("room_images")
}

// Room Maintenance Tracking
model MaintenanceLog {
  id          String    @id @default(cuid())
  roomId      String
  type        String // "Cleaning", "Repair", "Inspection", "Renovation"
  description String // Detailed description of work performed
  cost        Float? // Cost of maintenance/repair
  performedBy String // Staff member or contractor name
  startTime   DateTime // When maintenance started
  endTime     DateTime? // When maintenance completed
  isCompleted Boolean   @default(false)
  notes       String? // Additional notes or observations
  createdAt   DateTime  @default(now())

  // Relations
  room Room @relation(fields: [roomId], references: [id])

  @@index([roomId])
  @@index([isCompleted])
  @@index([type])
  @@map("maintenance_logs")
}

// Service Management Models
// Hotel services and add-ons

// Hotel Services - Additional services offered to guests
model Service {
  id       String          @id @default(cuid())
  code     String          @unique // "SPA001", "ROOM_SERVICE", etc.
  category ServiceCategory
  status   ServiceStatus   @default(ACTIVE)

  // Multi-language Service Information
  name        Json // {"en": "Room Service", "th": "บริการในห้อง"}
  description Json // Multi-language descriptions

  // Pricing & Availability
  basePrice Float
  currency  String @default("THB")
  taxRate   Float  @default(0.07) // 7% VAT

  // Service Configuration
  isActive         Boolean   @default(true)
  availableFrom    DateTime? // Service availability start
  availableTo      DateTime? // Service availability end
  maxQuantity      Int? // Maximum quantity per booking
  requiresApproval Boolean   @default(false) // Requires staff approval

  // Metadata
  notes     String? // Internal service notes
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  bookingServices BookingService[]

  @@index([category])
  @@index([status])
  @@index([isActive])
  @@map("services")
}

// Booking Services - Services linked to specific bookings
model BookingService {
  id         String   @id @default(cuid())
  bookingId  String
  serviceId  String
  quantity   Int      @default(1)
  unitPrice  Float // Price at time of booking (preserves historical pricing)
  totalPrice Float // quantity * unitPrice
  notes      String? // Special instructions or notes
  createdAt  DateTime @default(now())

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id])

  @@index([bookingId])
  @@index([serviceId])
  @@map("booking_services")
}

// System Management Models
// Audit trails, settings, and system configuration

// Audit Trail - Track all system changes for compliance
model AuditLog {
  id        String      @id @default(cuid())
  adminId   String
  action    AuditAction // CREATE, UPDATE, DELETE, LOGIN, LOGOUT
  entity    String // Table/Model name (e.g., "Booking", "Guest")
  entityId  String // Record ID that was affected
  oldValues Json? // Previous values before change
  newValues Json? // New values after change
  ipAddress String? // IP address of the admin
  userAgent String? // Browser/client information
  createdAt DateTime    @default(now())

  // Relations
  admin Admin @relation(fields: [adminId], references: [id])

  @@index([adminId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@index([action])
  @@map("audit_logs")
}

// System Settings - Configurable application parameters
model Settings {
  id        String   @id @default(cuid())
  key       String   @unique // Setting identifier (e.g., "hotel_name", "tax_rate")
  value     Json // Setting value (can be string, number, object, array)
  category  String? // Setting category for organization ("general", "payment", "email")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@map("settings")
}

// User Management Models
// Admin and Guest user accounts and authentication

// Admin Users - System administrators and staff
model Admin {
  id        String    @id @default(cuid())
  email     String    @unique
  username  String    @unique
  password  String // Hashed password (use bcrypt)
  firstName String
  lastName  String
  role      String    @default("ADMIN") // ADMIN, MANAGER, RECEPTIONIST
  isActive  Boolean   @default(true)
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations - Track admin activities
  auditLogs       AuditLog[]
  createdBookings Booking[]  @relation("AdminCreatedBookings")
  updatedBookings Booking[]  @relation("AdminUpdatedBookings")

  @@map("admins")
}

// Hotel Guests - Customer information and preferences
model Guest {
  id          String    @id @default(cuid())
  email       String    @unique
  phone       String?
  firstName   String
  lastName    String
  dateOfBirth DateTime?
  nationality String?
  passport    String? // Passport number for international guests

  // Address Information
  address    String?
  city       String?
  country    String?
  postalCode String?

  // Guest Profile & Preferences
  preferences String[] // ["late_checkout", "room_service", "spa"]
  status      GuestStatus @default(ACTIVE)
  vipLevel    Int         @default(0) // 0=Regular, 1=Silver, 2=Gold, 3=Platinum
  totalStays  Int         @default(0)
  totalSpent  Float       @default(0)
  notes       String? // Staff notes about guest preferences

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations - Guest activities and interactions
  bookings       Booking[]
  reviews        Review[]
  loyaltyProgram LoyaltyProgram?

  @@map("guests")
}
