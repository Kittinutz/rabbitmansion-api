model Payment {
  id              String        @id @default(uuid())
  bookingId       String
  amount          Float
  currency        String        @default("THB")
  paymentMethod   PaymentMethod
  status          PaymentStatus @default(PENDING)
  transactionId   String?
  gatewayResponse Json?
  paymentDetails  Json?         // SCB QR data, webhook data, refund info, etc.
  paidAt          DateTime?
  description     String?
  notes           String?
  
  // Stripe-specific fields
  stripePaymentIntentId  String?   @unique
  stripeCustomerId       String?
  stripePaymentMethodId  String?
  stripeChargeId         String?
  
  // Card details (if applicable)
  cardLast4       String?
  cardBrand       String?
  cardCountry     String?
  cardExpMonth    Int?
  cardExpYear     Int?
  
  // 3D Secure
  requiresAction  Boolean       @default(false)
  clientSecret    String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  booking         Booking       @relation(fields: [bookingId], references: [id])
  refunds         Refund[]

  @@index([bookingId])
  @@index([paymentMethod])
  @@index([status])
  @@index([stripePaymentIntentId])
  @@index([stripeCustomerId])
  @@map("payments")
}

model Refund {
  id             String       @id @default(uuid())
  paymentId      String
  amount         Float
  reason         String
  status         RefundStatus @default(PENDING)
  processedAt    DateTime?
  notes          String?
  stripeRefundId String?      // Stripe refund ID
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  payment        Payment      @relation(fields: [paymentId], references: [id])

  @@index([paymentId])
  @@index([status])
  @@map("refunds")
}

model SavedCard {
  id                    String   @id @default(uuid())
  guestId               String
  stripeCustomerId      String
  stripePaymentMethodId String   @unique
  cardLast4             String
  cardBrand             String
  cardExpMonth          Int
  cardExpYear           Int
  cardCountry           String?
  isDefault             Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  guest                 Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)
  
  @@index([guestId])
  @@index([stripeCustomerId])
  @@map("saved_cards")
}

model DailyRevenue {
  id             String   @id @default(uuid())
  date           DateTime @unique @db.Date
  roomRevenue    Float    @default(0)
  serviceRevenue Float    @default(0)
  totalRevenue   Float    @default(0)
  occupancyRate  Float    @default(0)
  adr            Float    @default(0)
  revpar         Float    @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([date])
  @@map("daily_revenue")
}
